<idea-plugin>
    <id>com.longlong.bookmark</id>
    <name>BookmarkPalace · 书签宫殿</name>
    
    <!-- 资源包，用于国际化 -->
    <resource-bundle>messages.LongLongBookmarkBundle</resource-bundle>
    <version>1.0.0</version>
    <vendor email="longlongcoder@qq.com" url="https://github.com/longlongcoder">龙龙 longlongcoder</vendor>

    <description><![CDATA[
    <h2>🏰 BookmarkPalace · 书签宫殿</h2>
    <p>JetBrains 增强代码书签系统 - 让代码导航更高效，帮助理解代码！</p>

    <h3>🌟 核心亮点：</h3>
    <ul>
        <li>🗺️ <b>可视化导览图</b> - 书签节点可在图中自由放置，串联代码流程</li>
        <li>✨ <b>智能追踪</b> - 基于 RangeMarker，代码变动后书签位置自动更新</li>
        <li>🎨 <b>9色标记</b> - 视觉化区分不同类型书签</li>
        <li>🌍 <b>中英双语</b> - 完整国际化支持</li>
        <li>📤 <b>AI友好导出</b> - JSON/Markdown/Mermaid 格式支持</li>
    </ul>

    <h3>适用场景：</h3>
    <ul>
        <li>代码审查时标记重点</li>
        <li>学习源码时构建阅读路线</li>
        <li>开发调试时记录关键位置</li>
        <li>与 AI 协作分析代码</li>
    </ul>
    
    <p><i>Made by 龙龙 longlongcoder</i></p>
    ]]></description>

    <change-notes><![CDATA[
    <h3>v1.0.0</h3>
    <ul>
        <li>初始版本发布</li>
        <li>书签核心功能：添加、删除、跳转、动态跟踪</li>
        <li>标签系统：多标签、颜色、分组</li>
        <li>导览图系统：Main Flow、Tag Flow、Custom Flow</li>
        <li>导入导出：JSON、Markdown、Mermaid</li>
    </ul>
    ]]></change-notes>

    <idea-version since-build="232" until-build="252.*"/>

    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.lang</depends>

    <extensions defaultExtensionNs="com.intellij">
        <!-- 项目级书签服务 -->
        <projectService
                serviceImplementation="com.longlong.bookmark.service.BookmarkService"/>

        <!-- 项目级标签服务 -->
        <projectService
                serviceImplementation="com.longlong.bookmark.service.TagService"/>

        <!-- 项目级导览图服务 -->
        <projectService
                serviceImplementation="com.longlong.bookmark.service.DiagramService"/>

        <!-- 书签持久化存储 -->
        <projectService
                serviceImplementation="com.longlong.bookmark.storage.BookmarkStorage"/>

        <!-- 工具窗口 -->
        <toolWindow
                id="BookmarkPalace"
                anchor="left"
                secondary="true"
                icon="/icons/logo.svg"
                factoryClass="com.longlong.bookmark.ui.BookmarkToolWindowFactory"
                bundle="messages.LongLongBookmarkBundle"
                key="tool.window.name"/>

        <!-- Gutter Icon 提供者 -->
        <codeInsight.lineMarkerProvider
                language=""
                implementationClass="com.longlong.bookmark.editor.BookmarkLineMarkerProvider"/>

        <!-- 编辑器监听器 -->
        <editorFactoryListener
                implementation="com.longlong.bookmark.editor.BookmarkEditorListener"/>

        <!-- 文件监听器 -->
        <projectService
                serviceImplementation="com.longlong.bookmark.service.FileChangeListener"/>

        <!-- 通知组 -->
        <notificationGroup
                id="BookmarkPalace"
                displayType="BALLOON"/>
        
        <!-- 导览图文件编辑器 -->
        <fileEditorProvider
                implementation="com.longlong.bookmark.ui.diagram.DiagramFileEditorProvider"/>
        
        <!-- 导览图文件类型（编辑模式） -->
        <fileType
                name="BookmarkPalace Diagram"
                implementationClass="com.longlong.bookmark.ui.diagram.DiagramFileType"
                extensions="lldiagram"/>
        
        <!-- 导览图文件类型（查看模式） -->
        <fileType
                name="BookmarkPalace Diagram View"
                implementationClass="com.longlong.bookmark.ui.diagram.DiagramViewFileType"
                extensions="lldiagramview"/>
        
        <!-- 导览图编辑器设置（应用级） -->
        <applicationService
                serviceImplementation="com.longlong.bookmark.settings.DiagramEditorSettings"/>
        
        <!-- 导览图标签页标题提供者 -->
        <editorTabTitleProvider
                implementation="com.longlong.bookmark.ui.diagram.DiagramTabTitleProvider"/>
        
        <!-- Alt+Enter 意图动作：添加书签（带对话框） -->
        <intentionAction>
            <className>com.longlong.bookmark.action.AddBookmarkIntention</className>
            <category>BookmarkPalace</category>
        </intentionAction>
        
        <!-- Alt+Enter 意图动作：快速添加书签 -->
        <intentionAction>
            <className>com.longlong.bookmark.action.QuickAddBookmarkIntention</className>
            <category>BookmarkPalace</category>
        </intentionAction>
    </extensions>

    <actions>
        <!-- 主菜单组 -->
        <group id="BookmarkPalace.MainMenu"
               popup="true">
            <override-text bundle="messages.LongLongBookmarkBundle" key="menu.name"/>
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </group>

        <!-- 添加书签 -->
        <action id="BookmarkPalace.AddBookmark"
                class="com.longlong.bookmark.action.AddBookmarkAction"
                icon="/icons/add_bookmark.svg">
            <override-text bundle="messages.LongLongBookmarkBundle" key="action.add.bookmark"/>
            <add-to-group group-id="BookmarkPalace.MainMenu" anchor="first"/>
            <add-to-group group-id="EditorPopupMenu" anchor="first"/>
            <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift B"/>
        </action>

        <!-- 快速添加书签（无对话框） -->
        <action id="BookmarkPalace.QuickAddBookmark"
                class="com.longlong.bookmark.action.QuickAddBookmarkAction"
                icon="/icons/quick_add.svg">
            <override-text bundle="messages.LongLongBookmarkBundle" key="action.quick.add"/>
            <add-to-group group-id="BookmarkPalace.MainMenu" anchor="after"
                          relative-to-action="BookmarkPalace.AddBookmark"/>
            <keyboard-shortcut keymap="$default" first-keystroke="ctrl alt B"/>
        </action>

        <!-- 显示书签列表 -->
        <action id="BookmarkPalace.ShowBookmarks"
                class="com.longlong.bookmark.action.ShowBookmarksAction"
                icon="/icons/bookmark_list.svg">
            <override-text bundle="messages.LongLongBookmarkBundle" key="action.show.bookmarks"/>
            <add-to-group group-id="BookmarkPalace.MainMenu" anchor="after"
                          relative-to-action="BookmarkPalace.QuickAddBookmark"/>
            <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift M"/>
        </action>

        <!-- 打开导览图 -->
        <action id="BookmarkPalace.OpenDiagram"
                class="com.longlong.bookmark.action.OpenDiagramAction"
                icon="/icons/diagram.svg">
            <override-text bundle="messages.LongLongBookmarkBundle" key="action.open.diagram"/>
            <add-to-group group-id="BookmarkPalace.MainMenu" anchor="after"
                          relative-to-action="BookmarkPalace.ShowBookmarks"/>
        </action>

        <!-- 导出 -->
        <action id="BookmarkPalace.Export"
                class="com.longlong.bookmark.action.ExportAction"
                icon="/icons/export.svg">
            <override-text bundle="messages.LongLongBookmarkBundle" key="action.export"/>
            <add-to-group group-id="BookmarkPalace.MainMenu" anchor="after"
                          relative-to-action="BookmarkPalace.OpenDiagram"/>
        </action>

        <!-- 导入 -->
        <action id="BookmarkPalace.Import"
                class="com.longlong.bookmark.action.ImportAction"
                icon="/icons/import.svg">
            <override-text bundle="messages.LongLongBookmarkBundle" key="action.import"/>
            <add-to-group group-id="BookmarkPalace.MainMenu" anchor="after"
                          relative-to-action="BookmarkPalace.Export"/>
        </action>

        <!-- 诊断导览图编辑器 -->
        <action id="BookmarkPalace.DiagnoseDiagramEditor"
                class="com.longlong.bookmark.action.DiagnoseDiagramEditorAction"
                text="诊断导览图编辑器"
                description="检查 Draw.io 编辑器配置和 jCEF 支持状态">
            <add-to-group group-id="BookmarkPalace.MainMenu" anchor="after"
                          relative-to-action="BookmarkPalace.Import"/>
        </action>

        <!-- 打赏与联系 -->
        <action id="BookmarkPalace.Donate"
                class="com.longlong.bookmark.action.DonateAction"
                icon="/icons/donate.svg">
            <override-text bundle="messages.LongLongBookmarkBundle" key="action.donate"/>
            <add-to-group group-id="BookmarkPalace.MainMenu" anchor="last"/>
        </action>
    </actions>

    <projectListeners>
        <listener
                class="com.longlong.bookmark.service.ProjectOpenListener"
                topic="com.intellij.openapi.project.ProjectManagerListener"/>
    </projectListeners>
</idea-plugin>
